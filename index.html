<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KZN-NYE 25/26 Destination Vote</title>
    <style>
        :root { --bg: linear-gradient(135deg, #667eea, #764ba2); --card: rgba(255,255,255,0.12); --accent: #ff6b6b; }
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: #fff;
            min-height: 100vh;
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
            padding-bottom: 90px;
        }
        header { padding: 30px 20px; background: rgba(0,0,0,0.3); }
        h1 { font-size: 2em; margin-bottom: 10px; }
        .subtitle { font-size: 1.1em; opacity: 0.9; }
        .destinations { padding: 20px; display: grid; gap: 28px; }
        .card {
            background: var(--card);
            border-radius: 20px;
            padding: 22px;
            backdrop-filter: blur(12px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .card img {
            width: 100%;
            height: 220px;
            object-fit: cover;
            border-radius: 16px;
            margin-bottom: 12px;
        }
        .card h2 { font-size: 1.7em; margin: 10px 0; }
        .card p { margin: 10px 0; line-height: 1.5; }
        .card ul { text-align: left; max-width: 480px; margin: 14px auto; }
        .card li { margin: 8px 0; }
        .pros li::marker { content: "Positive "; color: #4ecdc4; }
        .cons li::marker { content: "Warning "; color: #ff6b6b; }
        .vote-btn {
            width: 100%;
            padding: 18px;
            margin: 20px 0 8px;
            background: linear-gradient(135deg, #ff6b6b, #ff8e53);
            border: none;
            border-radius: 50px;
            color: white;
            font-size: 1.4em;
            font-weight: bold;
            cursor: pointer;
        }
        .vote-btn.voted { background: #555; cursor: not-allowed; }
        #results {
            margin: 30px 20px;
            padding: 25px;
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
        }
        .progress-bar {
            height: 26px;
            background: rgba(255,255,255,0.2);
            border-radius: 13px;
            overflow: hidden;
            margin: 12px 0;
        }
        .progress-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
            transition: width 0.8s ease;
        }
        .share {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            padding: 20px;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(10px);
        }
        .share-btn {
            background: #1da1f2;
            color: white;
            padding: 16px 40px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: bold;
            font-size: 1.2em;
            display: inline-block;
        }
        #confetti { position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:9999; }
        #thanks {
            position:fixed; top:0; left:0; width:100%; height:100%;
            background:rgba(0,0,0,0.92); color:white;
            display:none; justify-content:center; align-items:center;
            flex-direction:column; font-size:2em; z-index:99999;
        }
    </style>
</head>
<body>

<header>
    <h1>KZN-NYE 25/26 Destination Vote</h1>
    <p class="subtitle">7–10 people • 31 Dec 2026 – 2 Jan 2027 • KZN South Coast<br>R1200–R1400 p/p (2 nights + food/drinks)</p>
</header>

<section class="destinations" id="destinations">section>

<section id="results">
    <h2>Live Results</h2>
    <div id="progress-container">div>
section>

<div class="share">
    <a href="#" id="share" class="share-btn">Copy Share Link</a>
div>

<canvas id="confetti">canvas>
<div id="thanks">
    <div>Vote Received!</div>
    <div style="font-size:0.6em;margin-top:20px;">Thanks — watch the results update live</div>
div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyATZipoJembfjyTrvay0XeGDeOoMXpwyIg",
      authDomain: "kzn-nye25.firebaseapp.com",
      projectId: "kzn-nye25",
      storageBucket: "kzn-nye25.firebasestorage.app",
      messagingSenderId: "644646652528",
      appId: "1:644646652528:web:0312c427dfe3d10f2f42b5"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const votesRef = ref(db, 'votes');

    let votes = {};
    let total = 0;

    onValue(votesRef, (snap) => {
        votes = snap.val() || {};
        total = Object.values(votes).filter(v=>v).length;
        updateResults();
    });

    const places = [
        {
            id: "mantis",
            name: "Mantis & Moon Backpackers",
            area: "Umzumbe",
            img: "https://images.unsplash.com/photo-1519046904884-53103b34b206?w=800",
            cost: "R1200–R1350 pp",
            vibe: "Jungle surf lodge – bar, hot tub, wild NYE party",
            nye: "DJ, bonfire & fireworks on the lawn • R50 cover",
            pros: ["Epic bar & social vibe","Hot tub nights","Surf lessons","Very group friendly"],
            cons: ["Can get loud","Wildlife in rooms"],
            link: "https://mantisandmoon.net"
        },
        {
            id: "spot",
            name: "The Spot Backpackers",
            area: "Margate",
            img: "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=800",
            cost: "R1150–R1300 pp",
            vibe: "Classic beachfront hostel – direct beach access",
            nye: "Free street party + ocean fireworks right outside",
            pros: ["Cheapest option","Walk to everything","Sea views"],
            cons: ["Shared bathrooms","Basic facilities"],
            link: "https://thespotbackpackers.com"
        },
        {
            id: "santorini",
            name: "Santorini Village",
            area: "Ramsgate",
            img: "https://images.unsplash.com/photo-1533929736458-ca588d08c8be?w=800",
            cost: "R1300–R1400 pp",
            vibe: "Greek-style apartments – stunning sea views",
            nye: "Ramsgate main beach party 2 mins walk • R150 cover",
            pros: ["Best views","Modern & clean","Pool + balconies"],
            cons: ["Peak season premium"],
            link: "https://booking.com – search Santorini Village Ramsgate"
        },
        {
            id: "happy",
            name: "Happy Wanderers Resort",
            area: "Illovo",
            img: "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800",
            cost: "R1250–R1380 pp",
            vibe: "Full resort – restaurant, bar, private beach",
            nye: "On-site party, live music & fireworks • R80 cover",
            pros: ["Everything on site","Restaurant","Great for big groups"],
            cons: ["Monkeys","Can be busy"],
            link: "https://happywanderers.co.za"
        }
    ];

    const cont = document.getElementById('destinations');
    places.forEach(p => {
        cont.innerHTML += `
            <div class="card">
                <img src="${p.img}" alt="${p.name}">
                <h2>${p.name}<br><small>${p.area}small>h2>
                <p><strong>${p.cost}strong> • ${p.vibe}p>
                <p><strong>NYE:strong> ${p.nye}p>
                <ul class="pros"><strong>Prosstrong>${p.pros.map(x=>`<li>${x}li>`).join('')}ul>
                <ul class="cons"><strong>Consstrong>${p.cons.map(x=>`<li>${x}li>`).join('')}ul>
                <p>More info / book: <a href="${p.link}" style="color:#4ecdc4">${p.link.replace('https://','')}a>p>
                <button class="vote-btn" data-id="${p.id}">Vote ${p.name}button>
            div>`;
    });

    document.addEventListener('click', async e => {
        if (e.target.classList.contains('vote-btn')) {
            if (localStorage.getItem('kzn-voted')) {
                alert('You already voted — thank you!');
                return;
            }
            const id = e.target.dataset.id;
            await set(ref(db, 'votes/' + Date.now()), id);
            localStorage.setItem('kzn-voted', 'true');
            e.target.textContent = 'Voted!';
            e.target.classList.add('voted');
            confetti();
            document.getElementById('thanks').style.display = 'flex';
            setTimeout(()=> document.getElementById('thanks').style.display='none', 3000);
        }
    });

    function updateResults() {
        const c = document.getElementById('progress-container');
        c.innerHTML = '';
        places.forEach(p => {
            const count = Object.values(votes).filter(v=>v===p.id).length;
            const pct = total ? Math.round(count/total*100) : 0;
            c.innerHTML += `
                <p><strong>${p.name}strong> — ${count} votesp>
                <div class="progress-bar"><div class="progress-fill" style="width:${pct}%">div>div>
            `;
        });
    }

    // Share link button
    document.getElementById('share').onclick = e => {
        e.preventDefault();
        navigator.clipboard.writeText(location.href);
        e.target.textContent = 'Link Copied!';
        setTimeout(()=> e.target.textContent = 'Copy Share Link', 2000);
    };

    // Confetti
    function confetti() {
        const canvas = document.getElementById('confetti');
        const ctx = canvas.getContext('2d');
        canvas.width = innerWidth; canvas.height = innerHeight;
        const pieces = [];
        for(let i=0;i<180;i++){
            pieces.push({
                x: Math.random()*canvas.width,
                y: Math.random()*canvas.height - canvas.height,
                s: Math.random()*6+4,
                c: `hsl(${Math.random()*360},80%,60%)`
            });
        }
        function draw(){
            ctx.clearRect(0,0,canvas.width,canvas.height);
            pieces.forEach(p=>{
                p.y += p.s;
                ctx.fillStyle = p.c;
                ctx.fillRect(p.x, p.y, 10, 20);
            });
            if(pieces.some(p=>p.y<canvas.height)) requestAnimationFrame(draw);
        }
        draw();
    }

    updateResults();
script>
body>
html>
